=========================================包与流:

应用层在发送数据的时候，都是站在一个个包的视角，将包一个个发送出去，形成一个 stream，
接收端收到 stream 之后，再按照具体的协议切割还原成发送方所发送的包。
发送方每一次调用 send()，并不会在接收方有一次对应的 receive() 回调，
有可能发送方 send() 10 次，每次 10 个字节，但是接受方只有一次 receive() 回调，
一次将 100 个字节抛给应用层。receive() 收到的数据只能看做是一个 stream，
所以，这里有一个包转换为流，然后流再还原成包的过程。
HTTP 实现了这一过程，但 TCP 本身并不负责这一过程，当我们基于 TCP 或者其他传输层协议实现自己的通讯协议的时候，
需要自己来处理这一转换过程。

三种办法来做包与流之间的转换
办法一：特殊切割符来分割包
这种办法粗暴简单，我们使用一个特殊字符来作为包与包之间的分隔符，不过这个分隔符要特殊，特殊到几乎不出现在包的内容当中，否则会影响接收方切割包的过程。
这种做法的缺陷也是显而易见的，必须严格要求包体中不会出现该特殊字符，所以这种办法只能应用于非常特殊的场景。
办法二：每个包都是固定长度
这种办法也是粗暴简单，甚至不需要分隔符，每次接收方从 stream 中取出固定长度的字节，还原成一个包，
代码也比较简单，在 receive() 回调里，每次检查是否达到了固定的长度，是则取出固定长度还原，否则继续等待
这种做法的缺陷就更大了，会造成包体的浪费，无法适应不同大小的包。

办法三：自定义协议，支持可变长度的包
当我们需要描述可变长度的包时，需要定义一个 header 来详细描述包相关的信息，比如最简单的，记录包的长度
接收方在收到 NSData 之后，可以先读取 4 个字节的长度信息，还原成 int 值，再读取 int 值所记录的字节数，这些字节就是我们的包了

==================================================================================图解TCP/IP
WAN （Wide Area Network） 广域网
MAN （Metropolitan Area Network） 城域网：连接整个城市的网络
LAN （Local Area Network） 局域网

ISO: 国际标准化组织 international organization for standards
OSI: Open Systems Interconnection 开放式通信系统互联参考模型

NIC：Network Interface Card 也叫网卡，使计算机连网时所使用的部件

分组交换：将大数据分割位一个个叫做包（packet）的较小单位进行传输的方法。

源主机
目标主机

表示层：主要负责数据格式的转换，将设备固有的数据格式转换为网络标准传输格式
会话层：负责建立和断开通信连接。对何时建立连接，何时发送数据等进行管理
网络层：将数据传输到目标地址，负责寻址和路由选择
传输层：保证数据传输的可靠性是传输层的重要作用
数据链路层：作用就是在这些通过传输介质互连的设备之间进行数据处理

相互直连的设备之间使用MAC地址（物理地址或硬件地址）实现传输
MAC, Media Access Control：介质访问控制

###会话层负责决定建立连接和断开连接的时机，而传输层进行实际的建立和断开处理###
###实际将数据传输给对端的处理是由网络层来完成的###

根据接收端数量分类：
单播：Unicast
广播：broadcast
将消息从1台主机发送给与之相连的所有其他主机
进行广播通信的计算机有他们的广播范围。只有在这个范围之内的计算机才能收到相应的广播消息。范围叫做广播域
多播：Multicast
与广播类似，也是将消息发给多个接受主机。不同在于它要限定某一组主机作为接收端。
任播：Aycast
指在特定的多台主机中选出一台作为接收端的一种通信方式。
任播通信从目标主机群中选择一台最符合网络条件的主机作为目标主机发送消息。
被选中的那台特定主机将返回一个单播信号，随后发送端主机会只和这台主机进行通信。

地址唯一性
地址层次性
MAC地址和IP地址在标识一个通信主体时虽然都具有唯一性，但是他们当中只有IP地址具有层次性

MAC地址由设备的制造厂商针对每块网卡分别指定。
可以通过制造商识别号、制造商内部产品编号以及产品通用编号确保MAC地址的唯一性。

IP地址实现分层：
IP地址由网络号和主机号两部分组成。
即使通信主机的IP地址不同，若主机号不同，网络号相同，说明他们处于同一网段。
通常处于同一网段的主机也都属于同一部分或集团组织。
网络号相同的主机在组织结构、提供商类型和地域分布上都比较集中，也为IP寻址带来了极大的方便。

MAC寻址参考地址转发表，IP寻址参考路由控制表
根据地址转发表和路由表定位报文发送的目标设备。
地址转发表和路由控制表不需要在网络中的各个节点上手动设置，而是由这些节点自动生成的。
地址转发表根据自学自动生成。
路由控制表根据路由协议自动生成。
实际地址转发表和路由控制表能获取的信息不是具体的目标地址，而是该数据应该被发送出去的网卡信息。

MAC地址转发表中所记录的是实际的MAC地址本身，而路由表中记录的IP地址则是集中了之后的网络号。

通信媒介和数据链路:
在数据传输的过程中，两个设备之间数据流动的物理速度成为传输速率。单位为bps （Bits Per Second 每秒比特速）
严格意义上讲，各种传输媒介中信号的流动速度是恒定的。
传输速率又称为带宽（Bandwidth）
带宽越大网络传输能力就越强。

主机之间实际的传输速率被称作吞吐量。其单位和带宽相同。
吞吐量不仅衡量带宽，也衡量主机的CPU处理能力、网络的拥堵程度、报文中数据字段的占有份额（不含报文首部，只计算数据字段本身）等信息。

网卡：
网络接口卡（NIC）也被叫做网络适配器、网卡、LAN卡。
计算机和外部连接的接口称为计算机端口。

中继器：
中继器（Repeater）它在OSI模型的第一层，是物理层上延长网络的设备。
它是对减弱的信号进行放大和发送的设备。
它通过物理层的连接延长网络。
它的两端连接的是相同的通信媒介。

中继集线器也可以称为集线器或Hub。
集线器也可以看作是多口中继器。

网桥/2层交换机（L2交换机）：
它在OSI模型的第二层，数据链路层面上连接两个网络的设备。
它根据数据帧的内容转发数据给相邻的其他网络。
它能通过地址自学机制和过滤功能控制网络流量（网络上传输的数据报文的数量）

数据帧：与分组数据意思大致相同，但是在数据链路层中通常习惯称为帧。

具有网桥功能的Hub叫做交换集线器。
只有中继器功能的Hub叫做集线器。

路由器/3层交换机：
路由器是连接网络和网络的设备
可以将分组报文发送给另一个目标路由器地址。
它在OSI模型的第三层，网络层面上连接两个网络、并对分组报文进行转发的设备。
网桥是根据物理地址（MAC地址）进行处理，路由器根据IP地址进行处理的。

网关：
负责将从传输层到应用层的数据进行转换和转发的设备。

为了控制网络流量以及处于安全考虑，会使用代理服务器（Proxy Server），也是网关的一种，称为应用网关。
有了代理服务器，客户端和服务端之间无需在网络层上直接通信。而是从传输层到应用层对数据和访问进行各种控制和处理。
防火墙就是一款通过网关通信，针对不同应用提高安全性的产品。

代理服务器：代替服务器提供服务的系统。

ISP（Internet Service Provider）提供互联网接入服务的供应商

TCP/IP泛指IP或ICMP或TCP或UDP或TELNET或HTTP这些协议，也称为网际协议族。

TCP/IP规范：RFC （Request For Comment）

Internet指网际网，指连接一个又一个网络。
The Internet指互联网

每个网络之间通过NOC（Network Operation Center网络操作中心）相连。
如果网络的运营商不同，他的网络连接方式和使用方法也会不同。连接这种异构网络需要有IX（Internet Exchange网络交换中心）的支持。
总之，互联网就是众多异构的网络通过IX互联的一个巨型网络。

ISP和区域网：
区域网指的是在特定区域内由团体或者志愿者所运营的网络。这种通常价格比较便宜，有时会出现连接方式复杂或使用上有限制等情况。

驱动程序是在操作系统和硬件之间起桥梁作用的软件。

IP：
是跨越网络传送数据包。这期间它使用IP地址作为主机的标识。

ICMP：
IP数据包在发送途中一旦发生异常导致无法到达对端目标地址时，需要给发送端发送一个发生异常的通知。
ICMP就是为这一功能而制定的。它有时也被用来诊断网络的健康状况。

ARP：
从分组数据包的IP地址中解析出物理地址（MAC地址）的一种协议。

传输层:
主要的功能就是能够让应用程序之间实现通信。识别这些应用程序的是端口号。

UDP：
不会关注对端是否真的收到了传送过去的数据，如果需要检查对端是否收到分组数据包，或者对端是都连接到网络，则需要在应用程序中实现。

SMTP: Simple Mail Tranfer Protocol

FTP: 文件传输 Filr Tranfer Protocol

远程登录：
TELNET: TELetypewriter NETwork
SSH：Secure SHell

SNMP: 网络管理 Simple Network Management Protocol
可以对连网的设备进行远程修改配置，检查是否正常运行。
使用SNMP管理的主机，网桥，路由器等称作SNMP代理（Agent），而进行管理的那一端叫做管理器（Manager）。
SNMP正是这个Manager和Agent所用到的协议。

数据包首部：
首部中包含了该层必要的信息，如发送的目标地址以及协议的相关信息。
为协议提供的信息为包首部，所要发送的内容为数据。

包，帧，数据报，段，消息：
都用来表述数据的单位
包可以说是全能性术语。
帧用于数据链路层中包的单位。
数据包是IP和UDP等网络层以上的分层中包的单位。
段表示TCP数据流中的信息。
消息指应用协议中数据的单位。

发送数据包：###发送邮件的例子###
1.应用层处理
进行编码处理，编码相当于表示层功能
何时建立通信连接何时发送数据的管理功能，属于会话层的功能
应用在发送的那一刻建立TCP连接
2.TCP模块处理
负责建立连接，发送数据以及断开连接
TCP首部包括源端口号和目标端口号
3.IP模块的处理
IP首部包含接收端IP地址以及发送端IP地址。紧随IP首部的还有用来判断其后面数据是TCP还是UDP的信息
IP包生成后，参考路由控制表决定接受此IP包的路由或主机。

如果尚不知道接收端的MAC地址，利用ARP（Address Resolution Protocol）查找接收端MAC地址
只要知道了对端的MAC地址，就可以将MAC地址和IP地址交给以太网的驱动程序，实现数据传输。

4.网络接口（以太网驱动）的处理
以太网首部中包含接收端MAC地址，发送端MAC地址以及标志以太网类型的以太网数据的协议。
根据上述信息产生的以太网数据包将通过物理层传输给接收端。

包的最后则追加了以太网包尾（Ethernet Trailer）

FCS：Frame Check Sequence

每个分层的包首部中还包含一个标识位，它是用来标识上一层协议的种类信息（比如 数据链路层标识网络层）。
就是在应用的首部信息中，有时也会包含一个用来识别其数据类型的标签。

数据包接受处理：
1.网络接口（以太网驱动）的处理
主机收到以太网包以后，首先从以太网的包首部找到MAC地址判断是否为发给自己的包。
如果不是发给自己的包则丢弃数据。
如果接收到了发给自己的包，就查找以太网包首部中的类型域从而确定以太网协议所传送过来的数据类型。这个例子中的数据类型显然是IP包。
如果以太网包首部的类型域包含了一个无法识别的协议类型，则丢弃数据。
2.IP模块的处理
做类似处理。判断包首部中的IP地址与自己的IP地址是否匹配。
匹配则可接收数据并从中查找上一层的协议。
如果上一层是TCP就将IP包首部之后的部分传给TCP处理，UDP的话类似
对于有路由器的情况下，接收端地址往往不是自己的地址，需要借助路由控制表，在调查应该送达的主机或路由器以后再转发数据。
3.TCP模块的处理
在TCP模块中，首先会计算一下校验和，判断数据是否被破坏。
然后检查是否在按照序号接收数据。
最后检查端口号，确定具体的应用程序。
数据接收完毕后，接收端发送一个确认回执给发送端。
如果这个回执信息未能到达发送端，那么发送端会认为接收端没有接收到数据而一直反复发送。
数据被完整的接收以后，会传给由端口号识别的应用程序。

SNS：Social Network Service 社交网络

数据链路：
计算机以二进制0，1来表示信息，然而实际的通信媒介之间处理的却是电压的高低，光的闪灭以及电波的强弱信号。
把这些信号与二进制的0，1进行转换正是物理层的责任。
数据链路层处理的数据也不是单纯的0，1序列，该层把他们集合为一个叫做帧的块，然后再进行传输。

VLAN：Virtual Local Area Network 虚拟局域网
WLAN：Wireless Local Area Network 无限局域网
PPP：Point to point Protocol 点对点协议

MAC地址：
MAC地址长48比特
任何一个网卡的MAC地址都是唯一的
第一位：单播地址（0）/多播地址（1）
第二位：全局地址（0）/本地地址（1）
3-24位：厂商识别码，由IEEE管理并保证各厂家之间不重复
25-48位：由厂商管理并保证产品之间不重复

MAC地址一般用16进制表示

厂商识别码： OUI， Organizationally Unique Ideifier

共享介质型网络：由多个设备共享一个通信介质的一种网络。
它有两种介质访问控制方式：争用方式，令牌传递方式

非共享介质网络：网络中的每个站（节点）直连交换机，由交换机负责转发数据帧。
交换机检查帧中的目标地址，将数据帧直接转发给目标地址所连接的具体端口。

半双工指只发送或只接收的通信方式。
全双工指允许在同一时间既可以发送数据也可以接收数据。

交换机转发方式：
1.存储转发
检查以太网数据帧末尾的FCS位后再进行转发。
2.直通转发
不需要将整个帧全部接收下来以后再进行转发。只需要得知目标地址即可开始转发。具有延迟较短的优势，但有发送错误帧的可能性。